<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WAVELAB</title>
  <link rel="stylesheet" href="//cdn.bootcss.com/mdui/0.3.0/css/mdui.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
  <script src="/static/js/echarts.min.js"></script>
  <script src="//cdn.bootcss.com/mdui/0.3.0/js/mdui.min.js"></script>
  <style>
    #main{padding-left:0;}
  </style>
</head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-indigo mdui-theme-accent-white mdui-loaded">
  <div id="header" class="mdui-appbar mdui-appbar-fixed">
    <div class="mdui-toolbar mdui-color-theme">
      <a href="/" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon material-icons">trending_up</i></a>
      <a id="title" class="mdui-typo-title mdui-ripple" target="_blank"></a>
      <div class="mdui-toolbar-spacer"></div>
      <div class="header-search-wrapper hide-on-med-and-down sideNav-lock">
          <input id="searchbox" type="text" name="Search" class="header-search-input z-depth-2" placeholder="Search stock" autocomplete="off">
      </div>
      <label class="mdui-checkbox"><input id="favoriteCheckbox" type="checkbox" /><i class="mdui-checkbox-icon"></i>添加自选</label>
      <button class="mdui-btn mdui-btn-icon mdui-ripple" mdui-tooltip="{content: '添加交易'}" mdui-dialog="{target: '#addtrade',modal: true}"><i class="mdui-icon material-icons">add</i></button>
    </div>
  </div>
  <div class="mdui-drawer mdui-hidden-sm-down" id="left-drawer">
    <ul class="mdui-list" mdui-collapse="{accordion: false}">
      <li class="mdui-collapse-item mdui-collapse-item-open">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons">access_time</i>
          <div class="mdui-list-item-content">最近浏览</div>
          <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
        </div>
        <ul id="recentStock" class="mdui-collapse-item-body mdui-list mdui-list-dense">
          <!-- <li class="mdui-list-item mdui-ripple">New vs Returning</li> -->
        </ul>
      </li>

      <li class="mdui-collapse-item mdui-collapse-item-open">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons">favorite_border</i>
          <div class="mdui-list-item-content">自选股</div>
          <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
        </div>
        <ul id="favoriteStock" class="mdui-collapse-item-body mdui-list mdui-list-dense">
          <!-- <li class="mdui-list-item mdui-ripple">Overview</li> -->
        </ul>
      </li>
    </ul>
  </div>
  <div id="main" class="mdui-container-fluid"></div>
  <div class="mdui-dialog" id="addtrade">
    <div class="mdui-dialog-title">添加交易数据</div>
    <div class="mdui-dialog-content">
      <div class="mdui-container-fluid">
        <form id="addTradeData">
        <div class="mdui-row">
          <div class="mdui-col-xs-6">
            <div class="mdui-textfield">
              <label class="mdui-textfield-label">股票代码</label>
              <input class="mdui-textfield-input" name="code" type="text" id="tradeStockCode"/>
            </div>
          </div>
          <div class="mdui-col-xs-6">
            <div class="mdui-textfield">
            <label class="mdui-textfield-label">日期</label>
            <input class="mdui-textfield-input" name="date" type="text" id="tradeDate"/>
            </div>
          </div>
        </div>
        <div class="mdui-row">
          <div class="mdui-col-xs-6">
            <div class="mdui-textfield">
              <label class="mdui-textfield-label">价格</label>
              <input class="mdui-textfield-input" name="price" type="text" id="tradePrice"/>
            </div>
          </div>
          <div class="mdui-col-xs-6">
            <div class="mdui-textfield">
            <label class="mdui-textfield-label">交易数量</label>
            <input class="mdui-textfield-input" name="volume" type="text" id="tradeVolume"/>
            </div>
          </div>
        </div>
        <div class="mdui-row">
          <div class="mdui-col-xs-6">
            <label class="mdui-switch">
              <span>卖出&nbsp</span>
              <input name="type" type="checkbox" checked/>
              <i class="mdui-switch-icon"></i>
              <span>&nbsp买入</span>
            </label>
        </div>
        </div>
      </form>
      </div>
    </div>
    <div class="mdui-dialog-actions">
      <button class="mdui-btn mdui-ripple" mdui-dialog-close>取消</button>
      <button class="mdui-btn mdui-ripple" mdui-dialog-confirm>确定</button>
    </div>
  </div>
</div>
  <script src="/static/js/z.js" charset="utf-8"></script>
  <script src="/static/js/config.js" charset="utf-8"></script>
  <script src="/static/js/stock.js" charset="utf-8"></script>
  <script src="/static/js/detail.js" charset="utf-8"></script>
  <script type="text/javascript">
  var $ = mdui.JQ;
  $('#main').css('height', window.innerHeight - 64 + 'px');
  var stockCode = Z.getUrlParam().stockcode;
  var yearCount = Z.getUrlParam().yearcount ? Z.getUrlParam().yearcount : 1;
  var stockData = localStorage.getItem(stockCode) ? JSON.parse(localStorage.getItem(stockCode)) : {};
  var yestoday = '' + Z.getTime(-1).getFullYear() + '/' + (Z.getTime(-1).getMonth() + 1) + '/' + Z.getTime(-1).getDate();
  var today = '' + Z.getTime('year') + '/' + Z.getTime('month') + '/' + Z.getTime('day');
  //Does it need to be updated?
    if (!stockData.code || (Z.getTime('hour') < 15 && stockData.update != yestoday) || (Z.getTime('hour') < 15 && stockData.update == yestoday && stockData.yearcount < yearCount) || (Z.getTime('hour') >= 15 && stockData.update != today) || (Z.getTime('hour') >= 15 && stockData.update == today && stockData.yearcount < yearCount)){
        getStockData(initPage);
    }
    else {
        initPage({stockdata:stockData, dataamount:(yearCount*250)});
    }
  $('#favoriteCheckbox').on('click', function () {
    if (document.getElementById('favoriteCheckbox').checked) {
      addFavoriteStock(favoriteStock,stockData);
      updateFavoriteStockUl(document.getElementById('favoriteStock'),favoriteStock);
      stock.updateFavoriteStock(JSON.stringify(favoriteStock).replace(/"/g, '\\"'),'zhkf',function(str){
        mdui.snackbar({message:'favorite added.' + str,position:'top',timeout:800});
      });
      mdui.snackbar({message: 'favorite added.',position:'top',timeout:800});
    }else {
      delFavoriteStock(favoriteStock,stockData);
      updateFavoriteStockUl(document.getElementById('favoriteStock'),favoriteStock);
      stock.updateFavoriteStock(JSON.stringify(favoriteStock).replace(/"/g, '\\"'),'zhkf',function(str){
        mdui.snackbar({message: 'favorite deleted.' + str,position:'top',timeout:800});
      });
      mdui.snackbar({message: 'favorite deleted.',position:'top',timeout:800});
    }
  });

  $('#addtrade').on('opened.mdui.dialog',function(){
    $('#tradeStockCode').val(stockData.code);
    $('#tradeDate').val(Z.getCurrentDate(false));
  });
  $('#addtrade').on('confirm.mdui.dialog', function(){
    addTradeData();
  });
  $('#searchbox').on('keyup',function(event){
    if (event.key == "Enter") {
      stock.transCode($('#searchbox').val()) ? window.location.href='/detail/?stockcode='+stock.transCode($('#searchbox').val()) : mdui.snackbar({message: '股票代码格式不正确',position:'top',timeout:2000});;
    }
  });
  </script>
</body>
</html>
