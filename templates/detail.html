<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>WAVELAB</title>
  <link rel="stylesheet" href="//cdn.bootcss.com/mdui/0.3.0/css/mdui.min.css">
  <script src="/static/js/echarts.min.js"></script>
  <script src="//cdn.bootcss.com/mdui/0.3.0/js/mdui.min.js"></script>
</head>
<body class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-theme-primary-indigo mdui-theme-accent-white mdui-loaded">
  <header class="mdui-appbar mdui-appbar-fixed">
    <div class="mdui-toolbar mdui-color-theme">
      <a class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon material-icons">trending_up</i></a>
      <a id="title" class="mdui-typo-title mdui-ripple" target="_blank"></a>
      <div class="mdui-toolbar-spacer"></div>
      <div class="mdui-col-xs-2">
        <div class="mdui-textfield mdui-textfield-expandable mdui-float-right">
          <button class="mdui-textfield-icon mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></button>
          <input class="mdui-textfield-input" type="text" placeholder="Search" id="searchbox">
          <button class="mdui-textfield-close mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">close</i></button>
        </div>
      </div>
      <label class="mdui-checkbox"><input id="favoriteCheckbox" type="checkbox" /><i class="mdui-checkbox-icon"></i>添加自选</label>
      <button class="mdui-btn mdui-btn-icon mdui-ripple" mdui-tooltip="{content: '添加交易'}" mdui-dialog="{target: '#addtrade',modal: true}"><i class="mdui-icon material-icons">add</i></button>
    </div>
  </header>
  <div class="mdui-drawer mdui-hidden-sm-down" id="left-drawer">
    <ul class="mdui-list" mdui-collapse="{accordion: false}">
      <li class="mdui-collapse-item mdui-collapse-item-open">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons">access_time</i>
          <div class="mdui-list-item-content">最近浏览</div>
          <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
        </div>
        <ul id="recentStock" class="mdui-collapse-item-body mdui-list mdui-list-dense">
          <!-- <li class="mdui-list-item mdui-ripple">New vs Returning</li> -->
        </ul>
      </li>

      <li class="mdui-collapse-item mdui-collapse-item-open">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons">favorite_border</i>
          <div class="mdui-list-item-content">自选股</div>
          <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
        </div>
        <ul id="favoriteStock" class="mdui-collapse-item-body mdui-list mdui-list-dense">
          <!-- <li class="mdui-list-item mdui-ripple">Overview</li> -->
        </ul>
      </li>
    </ul>
  </div>
  <div id="main" class="mdui-container-fluid" style="height:800px;"></div>
  <div class="mdui-dialog" id="addtrade">
    <div class="mdui-dialog-title">添加交易数据</div>
    <div class="mdui-dialog-content">
      <div class="mdui-container-fluid">
        <form id="addTradeData">
        <div class="mdui-row">
          <div class="mdui-col-xs-6">
            <div class="mdui-textfield">
              <label class="mdui-textfield-label">股票代码</label>
              <input class="mdui-textfield-input" name="code" type="text" id="tradeStockCode"/>
            </div>
          </div>
          <div class="mdui-col-xs-6">
            <div class="mdui-textfield">
            <label class="mdui-textfield-label">日期</label>
            <input class="mdui-textfield-input" name="date" type="text" id="tradeDate"/>
            </div>
          </div>
        </div>
        <div class="mdui-row">
          <div class="mdui-col-xs-6">
            <div class="mdui-textfield">
              <label class="mdui-textfield-label">价格</label>
              <input class="mdui-textfield-input" name="price" type="text" id="tradePrice"/>
            </div>
          </div>
          <div class="mdui-col-xs-6">
            <div class="mdui-textfield">
            <label class="mdui-textfield-label">交易数量</label>
            <input class="mdui-textfield-input" name="volume" type="text" id="tradeVolume"/>
            </div>
          </div>
        </div>
        <div class="mdui-row">
          <div class="mdui-col-xs-6">
            <label class="mdui-switch">
              <span>卖出&nbsp</span>
              <input name="type" type="checkbox" checked/>
              <i class="mdui-switch-icon"></i>
              <span>&nbsp买入</span>
            </label>
        </div>
        </div>
      </form>
      </div>
    </div>
    <div class="mdui-dialog-actions">
      <button class="mdui-btn mdui-ripple" mdui-dialog-close>取消</button>
      <button class="mdui-btn mdui-ripple" mdui-dialog-confirm>确定</button>
    </div>
  </div>
</div>
  <script src="/static/js/z.js" charset="utf-8"></script>
  <script src="/static/js/config.js" charset="utf-8"></script>
  <script src="/static/js/detail.js" charset="utf-8"></script>
  <script src="/static/js/stock.js" charset="utf-8"></script>
  <script type="text/javascript">
  var $ = mdui.JQ;
  var stockCode = Z.getUrlParam().stockcode;
  var yearCount = Z.getUrlParam().yearcount ? Z.getUrlParam().yearcount : 1;
  var stockData = {};
    $.ajax({
        method : 'POST',
        url : '/ajax', 
        dataType : 'json', 
        data : {
            action : 'getstockdata', 
            stockcode : stockCode,
            yearcount : yearCount
        }, 
        success : function (data) {
            stockData = data;
            $('title').text(data.name + data.code + ' - WAVE LAB');
            $('#title').text(data.name + data.code)
            $('#title').prop('href', 'http://stockpage.10jqka.com.cn/' + data.code.substr(2) + '/');
            //document.getElementById('favoriteCheckbox').checked = (favoriteStock?(favoriteStock[stockData.name] !== undefined?true:false):false);
            var myChart = echarts.init(document.getElementById('main'));
            myChart.showLoading();
            display(data, myChart);
            myChart.hideLoading();
            updateRecentStock(data.code, data.name);
            recentStockDisplay();
        }
    });

function updateRecentStock(stockcode, stockname){ 
    if (Z.check.localStorageSupport() && localStorage.getItem('recentStock')) {
        var recentObj = JSON.parse(localStorage.getItem('recentStock'));
        var len = recentObj.length;
        var index = -1;
        for (e in recentObj) {
            if (recentObj[e][0] == stockcode) {
                index = e;
                recentObj.splice(e, 1);
                recentObj.unshift([stockcode, stockname]);
                break;
            }
        }
        if (index == -1) {
            if (len < 20) {
                recentObj.unshift([stockcode, stockname]);
            } else {
                recentObj.pop();
                recentObj.unshift([stockcode, stockname]);
            }
        }
        localStorage.setItem('recentStock', JSON.stringify(recentObj));
    } else {
        Z.check.localStorageSupport() && localStorage.setItem('recentStock', JSON.stringify([[stockcode, stockname]]));
    }
}
function recentStockDisplay() {
    recentObj = JSON.parse(localStorage.getItem('recentStock'));
    htmlStr = '';
    for (i in recentObj) {
        htmlStr += '<a href="/detail/?stockcode=' + recentObj[i][0] + '"><li class="mdui-list-item mdui-ripple">' + recentObj[i][1] + '</li></a>';
    }
    $('#recentStock').html(htmlStr);
}
  </script>
</body>
</html>
